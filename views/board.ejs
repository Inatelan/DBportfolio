<%- include('layout') %>

<h1>익명 자유게시판</h1>

<form action="/board/write" method="post" onsubmit="return attachRole(this)">
  <input type="hidden" name="role">

  <div>
    작성자:
    <input type="text" name="writer" required>
  </div>

  <div class="password-field">
    비밀번호 (클라이언트만):
    <input type="password" name="password">
  </div>

  <div>
    <textarea name="content" rows="4" required></textarea>
  </div>

  <button type="submit">게시글 작성</button>
</form>

<hr>

<% posts.forEach(post => { %>
  <div class="post">

    <p>
      <b><%= post.author %></b>
      (<%= post.created_at %>)
    </p>

    <p><%= post.content %></p>

    <!-- ===== 게시글 삭제 ===== -->
    <% if (post.canDelete) { %>
  <form action="/board/delete/<%= post.post_id %>" method="post"
        onsubmit="return attachRole(this)">
    <input type="hidden" name="role">

    <% if (currentRole === 'client') { %>
      <div class="password-field">
        <input type="password" name="password" placeholder="비밀번호">
      </div>
    <% } %>

    <button type="submit">삭제</button>
  </form>
<% } %>

    <hr>

    <!-- ===== 댓글 목록 ===== -->
    <% if (post.comments && post.comments.length > 0) { %>
      <% post.comments.forEach(comment => { %>
        <div class="comment">

          <b><%= comment.writer %></b>
          (<%= comment.created_at %>)<br>
          <%= comment.content %>

          <!-- ===== 댓글 삭제 ===== -->
          <% if (comment.canDelete) { %>
            <form action="/comment/delete/<%= comment.id %>" method="post"
                  onsubmit="return attachRole(this)">
              <input type="hidden" name="role">

              <div class="password-field">
                <input type="password" name="password" placeholder="비밀번호">
              </div>

              <button type="submit">삭제</button>
            </form>
          <% } %>

        </div>
      <% }) %>
    <% } else { %>
      <p>댓글이 없습니다.</p>
    <% } %>

    <!-- ===== 댓글 작성 ===== -->
    <form action="/comment/write" method="post" onsubmit="return attachRole(this)">
      <input type="hidden" name="post_id" value="<%= post.post_id %>">
      <input type="hidden" name="role">

      <input type="text" name="writer" placeholder="댓글 작성자" required>

      <div class="password-field">
        <input type="password" name="password" placeholder="비밀번호">
      </div>

      <input type="text" name="content" required>
      <button type="submit">댓글 작성</button>
    </form>

  </div>
<% }) %>

    </div> <!-- main 닫기 -->

    <div class="sidebar">
      <h3>디버그용 역할 선택</h3>

      <label>
        <input type="radio" name="role" value="host" onclick="setRole('host')">
        호스트
      </label><br>

      <label>
        <input type="radio" name="role" value="client" onclick="setRole('client')">
        클라이언트
      </label>

      <hr>

      <p>
        • 호스트: 모든 게시글·댓글 삭제 가능 ( 비밀번호 불필요 )<br>
        • 클라이언트: 비밀번호 필요, 호스트의 요소 삭제 불가능 ( 비밀번호 필수 )<br>

      </p>
    </div>
  </div>
</body>
</html>
